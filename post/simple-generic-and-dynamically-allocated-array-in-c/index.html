<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Simple, generic and dynamically allocated array in C &#183; {love to code}</title><meta name=description content><link type=text/css rel=stylesheet href=https://navaneeth.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://navaneeth.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://navaneeth.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://navaneeth.github.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://navaneeth.github.io/><h1>{love to code}</h1></a><p class=lead></p></div><nav><ul class=sidebar-nav><li><a href=https://navaneeth.github.io/>Home</a></li><li><a href=https://github.com/navaneeth/>Github</a></li><li><a href=https://twitter.com/navaneeth>Twitter</a></li></ul></nav><p>&copy; 2021. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Simple, generic and dynamically allocated array in C</h1><time datetime=2012-05-11T12:59:50+0530 class=post-date>Fri, May 11, 2012</time><p>C is a very good language. I have been using for quite some time for my opensource project. The flexibility C offers is really good. But sometimes, lack of simple datastructures like a dynamically growing array will slow down the programmer. There are tons of implementation available online, but most of them are overcomplicated, got lot of dependencies or tough to understand and incorporate with your application. In this post, I present a simple array which grows dynamically, reuses the memory, supports any pointer type and easy to copy to your code base.</p><p>Here is the code.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>
<span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> varray_t
{
   <span style=color:#66d9ef>void</span> <span style=color:#f92672>**</span>memory;
   size_t allocated;
   size_t used;
   <span style=color:#66d9ef>int</span> index;
} varray;

<span style=color:#66d9ef>void</span>
<span style=color:#a6e22e>varray_init</span>(varray <span style=color:#f92672>**</span>array)
{
   <span style=color:#f92672>*</span>array <span style=color:#f92672>=</span> (varray<span style=color:#f92672>*</span>) malloc (<span style=color:#66d9ef>sizeof</span>(varray));
   (<span style=color:#f92672>*</span>array)<span style=color:#f92672>-&gt;</span>memory <span style=color:#f92672>=</span> NULL;
   (<span style=color:#f92672>*</span>array)<span style=color:#f92672>-&gt;</span>allocated <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
   (<span style=color:#f92672>*</span>array)<span style=color:#f92672>-&gt;</span>used <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
   (<span style=color:#f92672>*</span>array)<span style=color:#f92672>-&gt;</span>index <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
}

<span style=color:#66d9ef>void</span>
<span style=color:#a6e22e>varray_push</span>(varray <span style=color:#f92672>*</span>array, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>data)
{
   size_t toallocate;
   size_t size <span style=color:#f92672>=</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>);
   <span style=color:#66d9ef>if</span> ((array<span style=color:#f92672>-&gt;</span>allocated <span style=color:#f92672>-</span> array<span style=color:#f92672>-&gt;</span>used) <span style=color:#f92672>&lt;</span> size) {
      toallocate <span style=color:#f92672>=</span> array<span style=color:#f92672>-&gt;</span>allocated <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> size : (array<span style=color:#f92672>-&gt;</span>allocated <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>);
      array<span style=color:#f92672>-&gt;</span>memory <span style=color:#f92672>=</span> realloc(array<span style=color:#f92672>-&gt;</span>memory, toallocate);
      array<span style=color:#f92672>-&gt;</span>allocated <span style=color:#f92672>=</span> toallocate;
   }

   array<span style=color:#f92672>-&gt;</span>memory[<span style=color:#f92672>++</span>array<span style=color:#f92672>-&gt;</span>index] <span style=color:#f92672>=</span> data;
   array<span style=color:#f92672>-&gt;</span>used <span style=color:#f92672>=</span> array<span style=color:#f92672>-&gt;</span>used <span style=color:#f92672>+</span> size;
}

<span style=color:#66d9ef>int</span>
<span style=color:#a6e22e>varray_length</span>(varray <span style=color:#f92672>*</span>array)
{
   <span style=color:#66d9ef>return</span> array<span style=color:#f92672>-&gt;</span>index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
}

<span style=color:#66d9ef>void</span>
<span style=color:#a6e22e>varray_clear</span>(varray <span style=color:#f92672>*</span>array)
{
   <span style=color:#66d9ef>int</span> i;
   <span style=color:#66d9ef>for</span>(i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> varray_length(array); i<span style=color:#f92672>++</span>)
   {
      array<span style=color:#f92672>-&gt;</span>memory[i] <span style=color:#f92672>=</span> NULL;
   }
   array<span style=color:#f92672>-&gt;</span>used <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
   array<span style=color:#f92672>-&gt;</span>index <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
}

<span style=color:#66d9ef>void</span>
<span style=color:#a6e22e>varray_free</span>(varray <span style=color:#f92672>*</span>array)
{
   free(array<span style=color:#f92672>-&gt;</span>memory);
   free(array);
}

<span style=color:#66d9ef>void</span><span style=color:#f92672>*</span>
<span style=color:#a6e22e>varray_get</span>(varray <span style=color:#f92672>*</span>array, <span style=color:#66d9ef>int</span> index)
{
   <span style=color:#66d9ef>if</span> (index <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> index <span style=color:#f92672>&gt;</span> array<span style=color:#f92672>-&gt;</span>index)
      <span style=color:#66d9ef>return</span> NULL;

   <span style=color:#66d9ef>return</span> array<span style=color:#f92672>-&gt;</span>memory[index];
}

<span style=color:#66d9ef>void</span>
<span style=color:#a6e22e>varray_insert</span>(varray <span style=color:#f92672>*</span>array, <span style=color:#66d9ef>int</span> index, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>data)
{
   <span style=color:#66d9ef>if</span> (index <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> index <span style=color:#f92672>&gt;</span> array<span style=color:#f92672>-&gt;</span>index)
      <span style=color:#66d9ef>return</span>;

   array<span style=color:#f92672>-&gt;</span>memory[index] <span style=color:#f92672>=</span> data;
}
</code></pre></div><p>This array doesnâ€™t take ownership of the data it contains. Ownership has to be managed separately. When adding a new item, array grows in constant propotion yielding inserts in amortized constant time. I have omitted error checking for malloc and realloc for simplicity.</p><p>Hope you enjoy the post.</p></div></main></body></html>