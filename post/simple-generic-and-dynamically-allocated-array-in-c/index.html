<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Simple, generic and dynamically allocated array in C &middot; nkn</title>

  
  <link rel="stylesheet" href="http://blog.nkn.io/css/poole.css">
  <link rel="stylesheet" href="http://blog.nkn.io/css/hyde.css">
  <link rel="stylesheet" href="http://blog.nkn.io/css/poole-overrides.css">
  <link rel="stylesheet" href="http://blog.nkn.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://blog.nkn.io/css/hyde-x.css">
  <link rel="stylesheet" href="http://blog.nkn.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.nkn.io/touch-icon-144-precomposed.png">
  <link href="http://blog.nkn.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38544003-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>nkn</h1>
      <p class="lead">{love to code}</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://blog.nkn.io/">blog</a></li>
      
      <li class="sidebar-nav-item"><a href="http://blog.nkn.io/about/">about</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://www.flickr.com/photos/navaneethkn"><i class="fa fa-flickr fa-3x"></i></a>
      <a href="https://github.com/navaneeth/"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      
      <a href="http://twitter.com/navaneethkn"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://blog.nkn.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <p>Copyright &copy; 2017 <a href="http://blog.nkn.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Simple, generic and dynamically allocated array in C</h1>
    <span class="post-date">May 11, 2012 &middot; 2 minute read &middot; <a href="http://blog.nkn.io/post/simple-generic-and-dynamically-allocated-array-in-c/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://blog.nkn.io/categories/programming">programming</a><a class="label" href="http://blog.nkn.io/categories/datastructures">datastructures</a><a class="label" href="http://blog.nkn.io/categories/c">c</a>
    </span>
    <p>C is a very good language. I have been using for quite some time for my opensource project. The flexibility C offers is really good. But sometimes, lack of simple datastructures like a dynamically growing array will slow down the programmer. There are tons of implementation available online, but most of them are overcomplicated, got lot of dependencies or tough to understand and incorporate with your application. In this post, I present a simple array which grows dynamically, reuses the memory, supports any pointer type and easy to copy to your code base.</p>

<p>Here is the code.</p>

<pre><code class="language-c">
typedef struct varray_t
{
   void **memory;
   size_t allocated;
   size_t used;
   int index;
} varray;

void
varray_init(varray **array)
{
   *array = (varray*) malloc (sizeof(varray));
   (*array)-&gt;memory = NULL;
   (*array)-&gt;allocated = 0;
   (*array)-&gt;used = 0;
   (*array)-&gt;index = -1;
}

void
varray_push(varray *array, void *data)
{
   size_t toallocate;
   size_t size = sizeof(void*);
   if ((array-&gt;allocated - array-&gt;used) &lt; size) {
      toallocate = array-&gt;allocated == 0 ? size : (array-&gt;allocated * 2);
      array-&gt;memory = realloc(array-&gt;memory, toallocate);
      array-&gt;allocated = toallocate;
   }

   array-&gt;memory[++array-&gt;index] = data;
   array-&gt;used = array-&gt;used + size;
}

int
varray_length(varray *array)
{
   return array-&gt;index + 1;
}

void
varray_clear(varray *array)
{
   int i;
   for(i = 0; i &lt; varray_length(array); i++)
   {
      array-&gt;memory[i] = NULL;
   }
   array-&gt;used = 0;
   array-&gt;index = -1;
}

void
varray_free(varray *array)
{
   free(array-&gt;memory);
   free(array);
}

void*
varray_get(varray *array, int index)
{
   if (index &lt; 0 || index &gt; array-&gt;index)
      return NULL;

   return array-&gt;memory[index];
}

void
varray_insert(varray *array, int index, void *data)
{
   if (index &lt; 0 || index &gt; array-&gt;index)
      return;

   array-&gt;memory[index] = data;
}
</code></pre>

<p>This array doesnâ€™t take ownership of the data it contains. Ownership has to be managed separately. When adding a new item, array grows in constant propotion yielding inserts in amortized constant time. I have omitted error checking for malloc and realloc for simplicity.</p>

<p>Hope you enjoy the post.</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "lovetocode";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "lovetocode";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://blog.nkn.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

